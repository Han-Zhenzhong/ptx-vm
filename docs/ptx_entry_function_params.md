> â€œPTX çš„å‡½æ•°ï¼ˆå°¤å…¶æ˜¯ `.entry` å†…æ ¸å‡½æ•°ï¼‰åˆ°åº•èƒ½æ¥æ”¶å“ªäº›ç±»å‹çš„å‚æ•°ï¼Œä»¥åŠè¿™äº›å‚æ•°åœ¨ Host â†” Device ä¹‹é—´æ˜¯å¦‚ä½•ä¼ é€’çš„ï¼Ÿâ€

æˆ‘ä»¬æ¥ç³»ç»Ÿè®²æ¸…æ¥šè¿™ä¸€ç‚¹ã€‚

---

## ğŸ§  ä¸€ã€PTX ä¸­çš„å‡½æ•°ç±»å‹

PTX æœ‰ä¸¤ç±»å‡½æ•°ï¼š

1. `.entry` â€”â€” **kernel å‡½æ•°**ï¼ˆå¯ä» Host è°ƒç”¨ï¼Œç”¨äº GPU æ‰§è¡Œï¼‰
2. `.func` â€”â€” **æ™®é€š device å‡½æ•°**ï¼ˆåªèƒ½è¢«å…¶ä»– GPU å‡½æ•°è°ƒç”¨ï¼‰

**å‚æ•°è§„åˆ™ä¸»è¦é’ˆå¯¹ `.entry`ã€‚**

---

## ğŸš€ äºŒã€`.entry` å‡½æ•°å‚æ•°åœ¨ PTX ä¸­çš„å®šä¹‰æ–¹å¼

PTX ä¸­çš„ kernel å®šä¹‰ç¤ºä¾‹ï¼š

```ptx
.visible .entry myKernel(
    .param .u64 A,     // æŒ‡é’ˆå‚æ•°
    .param .u32 N,     // æ•´æ•°å‚æ•°
    .param .f32 alpha  // æµ®ç‚¹å‚æ•°
)
{
    // å†…éƒ¨ä»£ç ...
}
```

è¿™é‡Œçš„æ¯ä¸ª `.param` è¡¨ç¤ºä¸€ä¸ª **å½¢å‚æ§½ï¼ˆparameter slotï¼‰**ï¼Œ
å‚æ•°ç±»å‹æ˜¯åŸºäº PTX çš„æ•°æ®ç±»å‹ç³»ç»Ÿã€‚

---

## ğŸ§© ä¸‰ã€PTX å¯æ¥æ”¶çš„å‚æ•°ç±»å‹ç±»åˆ«

PTX çš„ `.param` å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç±»ï¼ˆæœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨ Host å¯åŠ¨ kernel æ—¶ä¼ å…¥çš„å†…å­˜å­—èŠ‚å—ï¼‰ï¼š

| ç±»å‹ç±»åˆ«         | PTX ç±»å‹                                        | å…¸å‹ç”¨æ³•             | Host ä¾§å¯¹åº”ç±»å‹                                |
| ------------ | --------------------------------------------- | ---------------- | ----------------------------------------- |
| **æ ‡é‡æ•´æ•°**     | `.u8`, `.u16`, `.u32`, `.u64`, `.s32`, `.s64` | ç”¨äºä¼ é€’ç´¢å¼•ã€é•¿åº¦ã€æ ‡å¿—ç­‰    | `unsigned int`, `int`, `long`, `size_t`   |
| **æ ‡é‡æµ®ç‚¹**     | `.f16`, `.f32`, `.f64`                        | ç”¨äºæµ®ç‚¹å‚æ•°           | `float`, `double`                         |
| **æŒ‡é’ˆç±»å‹**     | `.u64` (ä¸€èˆ¬ä¸º64ä½åœ°å€)                             | ä¼ é€’ GPU å…¨å±€å†…å­˜åœ°å€    | `CUdeviceptr` æˆ– Runtime API ä¸­çš„ `float*` ç­‰ |
| **ç»“æ„ä½“/å¤åˆç±»å‹** | `.param .align` + `{}`                        | å¯ä¼ å¤æ‚æ•°æ®ç»“æ„ï¼ˆéœ€è¦å¯¹é½å¤„ç†ï¼‰ | C structï¼ˆæŒ‰å­—èŠ‚åºä¼ å…¥ï¼‰                          |

---

## ğŸ§® å››ã€Host ä¾§å¦‚ä½•å¯¹åº”è¿™äº›å‚æ•°

ä»¥ CUDA Driver API (`cuLaunchKernel`) ä¸ºä¾‹ï¼š

```c
void *args[] = { &d_A, &N, &alpha };
```

æ¯ä¸ªæŒ‡é’ˆå¯¹åº” `.param` çš„ä¸€ä¸ªæ§½ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºä¸‹é¢çš„ PTXï¼š

```ptx
.visible .entry scaleAdd(
    .param .u64 ptrA,
    .param .u32 N,
    .param .f32 alpha
)
```

Host ä¼ å‚æ–¹å¼ï¼š

```c
CUdeviceptr d_A;
unsigned int N = 1024;
float alpha = 2.5f;

void *args[] = { &d_A, &N, &alpha };
cuLaunchKernel(kernel, 1,1,1, N,1,1, 0, 0, args, 0);
```

CUDA é©±åŠ¨ä¼šè‡ªåŠ¨å°†è¿™äº›å‚æ•°æ‰“åŒ…è¿› kernel å‚æ•°å†…å­˜ï¼ˆparam spaceï¼‰ï¼ŒGPU å†…éƒ¨å†é€šè¿‡ `ld.param.*` æŒ‡ä»¤å–å‡ºã€‚

---

## ğŸ§± äº”ã€åœ¨ PTX å†…éƒ¨å¦‚ä½•è®¿é—®è¿™äº›å‚æ•°

ä»¥ `.param .u64 A` ä¸ºä¾‹ï¼š

```ptx
.visible .entry myKernel(
    .param .u64 A,
    .param .u32 N
)
{
    .reg .u32 %r<3>;
    .reg .u64 %rd<3>;

    ld.param.u64 %rd1, [A];   // å–å‡ºæŒ‡é’ˆå‚æ•° A
    ld.param.u32 %r1, [N];    // å–å‡ºæ ‡é‡å‚æ•° N
}
```

å¦‚æœä¼ å…¥çš„æ˜¯ç»“æ„ä½“ï¼Œè®¿é—®ç±»ä¼¼è¿™æ ·ï¼š

```ptx
.param .align 8 .b8 s[16];  // ç»“æ„ä½“å¤§å°16å­—èŠ‚
ld.param.v2.f32 {%f1, %f2}, [s+0]; // è¯»å–ç»“æ„ä½“å‰8å­—èŠ‚
```

---

## ğŸ“¦ å…­ã€å¯ä»¥ä¼ ç»“æ„ä½“æˆ–æ•°ç»„å—ï¼Ÿ

å¯ä»¥ï¼Œä½†æœ‰å‡ ç‚¹è¦æ³¨æ„ï¼š

### âœ… ç»“æ„ä½“

PTX æ”¯æŒ `.param .align N .b8 var[size];` æ¥å®šä¹‰ç»“æ„ä½“å‚æ•°ç©ºé—´ï¼Œ
Host ä¾§å¯ä»¥ä¼ å…¥ç»“æ„ä½“çš„å­—èŠ‚æ‹·è´ï¼ˆæŒ‰å­—èŠ‚åºï¼‰ã€‚

ä¾‹ï¼š

```ptx
.visible .entry kernelStruct(
    .param .align 8 .b8 config[16]
)
{
    .reg .f32 %f1, %f2;
    ld.param.f32 %f1, [config+0];
    ld.param.f32 %f2, [config+4];
}
```

Host ä¾§ï¼š

```c
struct Config { float a, b; };
Config cfg = {1.0f, 2.0f};
void *args[] = { &cfg };
```

### âš ï¸ æ•°ç»„

ä¸èƒ½ç›´æ¥ä¼ â€œæ•°ç»„â€ç±»å‹ï¼Œåªèƒ½ä¼ â€œæŒ‡é’ˆåˆ°æ•°ç»„â€æˆ–â€œåŒ…å«æ•°ç»„çš„ç»“æ„ä½“â€ã€‚

> å› ä¸ºå‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’çš„å­—èŠ‚å—ï¼Œä¸ä¼šè‡ªåŠ¨å±•å¼€ã€‚

---

## ğŸ§° ä¸ƒã€ç‰¹æ®Šç±»å‹

| ç±»å‹                            | æè¿°             | ç¤ºä¾‹                               |
| ----------------------------- | -------------- | -------------------------------- |
| `.b8`, `.b16`, `.b32`, `.b64` | åŸå§‹å­—èŠ‚ï¼ˆå¯ç”¨äºä»»ä½•ç±»å‹ï¼‰  | `.param .b32 flag`               |
| `.pred`                       | å¸ƒå°”æ ‡å¿—ï¼ˆå¾ˆå°‘ç”¨ä½œå‚æ•°ï¼‰   | ä¸æ¨èç›´æ¥ä¼                            |
| `.texref`, `.surfref`         | çº¹ç†ã€è¡¨é¢å¼•ç”¨        | ç”± CUDA ç¼–è¯‘å™¨å†…éƒ¨ç”Ÿæˆ                   |
| `.samplerref`                 | é‡‡æ ·å™¨å¯¹è±¡          | åŒä¸Š                               |
| `.ptr`                        | é€šç”¨æŒ‡é’ˆï¼ˆæ–° PTX æ”¯æŒï¼‰ | `.param .ptr .global .align 8 A` |

---

## ğŸ§© å…«ã€æ€»ç»“å¯¹ç…§è¡¨

| Host ç±»å‹                           | PTX å‚æ•°ç±»å‹        | è¯´æ˜            |
| --------------------------------- | --------------- | ------------- |
| `int` / `unsigned int`            | `.u32` / `.s32` | 32ä½æ•´æ•°         |
| `size_t` / `unsigned long long`   | `.u64`          | 64ä½æ•´æ•°æˆ–æŒ‡é’ˆ      |
| `float` / `double`                | `.f32` / `.f64` | æµ®ç‚¹å‚æ•°          |
| `float*` / `int*` / `CUdeviceptr` | `.u64`          | GPU å…¨å±€å†…å­˜æŒ‡é’ˆ    |
| `struct {...}`                    | `.b8 [N]` + å¯¹é½  | æŒ‰å­—èŠ‚æ‹·è´ç»“æ„ä½“      |
| `bool`                            | `.pred`ï¼ˆä¸æ¨èï¼‰    | é€šå¸¸ç”¨ `.u32` æ›¿ä»£ |

---

## ğŸ” ä¹ã€ç¤ºä¾‹æ€»ç»“

PTX ä¾§ï¼š

```ptx
.visible .entry kernelDemo(
    .param .u64 A,
    .param .u32 N,
    .param .f32 alpha,
    .param .align 8 .b8 cfg[16]
)
```

Host ä¾§ï¼š

```c
CUdeviceptr d_A;
unsigned int N = 1000;
float alpha = 2.0f;
struct { float x, y, z, w; } cfg = {1, 2, 3, 4};

void *args[] = { &d_A, &N, &alpha, &cfg };
cuLaunchKernel(func, grid, 1,1, block,1,1, 0, 0, args, 0);
```

---
